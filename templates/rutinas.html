{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">üí™ Rutinas de Entrenamiento</h2>
  <p class="text-center">Selecciona un entorno y descubre rutinas dise√±adas para ese espacio.</p>

  <!-- TARJETAS DE CATEGOR√çAS -->
  <div class="row mt-4" id="contenedor-tarjetas">
    <!-- RUTINAS EN CASA -->
    <div class="col-md-4 mb-4">
      <div class="card p-3 shadow-sm h-100 categoria-card">
        <h5>üè† Rutinas en Casa</h5>
        <p>Entrena desde la comodidad de tu hogar con poco o ning√∫n equipo.</p>
        <button class="btn btn-primary w-100" type="button" onclick="toggleSection('casa')">Ver Rutinas</button>
        <div id="casa" class="rutina-section mt-3 collapse">
          <ul class="list-group">
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Rutina Full Body (sin pesas)', this)">Rutina Full Body (sin pesas)</li>
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Cardio 20 min en casa', this)">Cardio 20 min en casa</li>
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Yoga y estiramientos matutinos', this)">Yoga y estiramientos matutinos</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- RUTINAS LABORALES -->
    <div class="col-md-4 mb-4">
      <div class="card p-3 shadow-sm h-100 categoria-card">
        <h5>üíº Rutinas Laborales</h5>
        <p>Ejercicios cortos para realizar durante tu jornada laboral.</p>
        <button class="btn btn-primary w-100" type="button" onclick="toggleSection('laboral')">Ver Rutinas</button>
        <div id="laboral" class="rutina-section mt-3 collapse">
          <ul class="list-group">
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Ejercicios de estiramiento en oficina', this)">Ejercicios de estiramiento en oficina</li>
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Pausas activas de 10 minutos', this)">Pausas activas de 10 minutos</li>
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Movilidad cervical y lumbar', this)">Movilidad cervical y lumbar</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- RUTINAS AL AIRE LIBRE -->
    <div class="col-md-4 mb-4">
      <div class="card p-3 shadow-sm h-100 categoria-card">
        <h5>üå≥ Rutinas al Aire Libre</h5>
        <p>Aprovecha el espacio exterior para entrenar y conectar con la naturaleza.</p>
        <button class="btn btn-primary w-100" type="button" onclick="toggleSection('airelibre')">Ver Rutinas</button>
        <div id="airelibre" class="rutina-section mt-3 collapse">
          <ul class="list-group">
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Caminata + trote ligero', this)">Caminata + trote ligero</li>
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Circuito de ejercicios en parque', this)">Circuito de ejercicios en parque</li>
            <li class="list-group-item rutina-item" onclick="mostrarRutinaDetallada('Entrenamiento con peso corporal', this)">Entrenamiento con peso corporal</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- SECCI√ìN DETALLADA -->
  <div class="d-flex justify-content-end mb-2">
    <button id="btn-volver" class="btn btn-outline-secondary d-none" onclick="restaurarVista()">‚Üê Ver todas las rutinas</button>
  </div>

  <div id="detalle-rutina" class="mt-2 p-4 rounded shadow-sm bg-light d-none">
    <h3 id="titulo-rutina" class="text-center mb-3"></h3>
    <p id="descripcion-rutina" class="text-center"></p>
    <div id="meta-rutina" class="text-center mb-3"></div>
    <hr>
    <div id="acordeon-pasos" class="accordion"></div>
  </div>
</div>

<!-- ESTILOS LOCALES -->
<style>
.rutina-item {
  cursor: pointer;
  transition: 0.18s ease;
}
.rutina-item:hover {
  background-color: #0d6efd;
  color: #fff;
  transform: translateY(-2px);
}
.rutina-item.activa {
  background-color: #0d6efd;
  color: white;
  font-weight: 600;
}
.categoria-card.inactiva {
  opacity: 0.35;
  pointer-events: none;
  transition: 0.25s ease;
}
#detalle-rutina { animation: fadeIn 220ms ease; }
@keyframes fadeIn { from {opacity:0; transform: translateY(6px);} to {opacity:1; transform:none;} }
</style>

<!-- SCRIPT FUNCIONAL -->
<script>
// ---------- DATOS LOCALES (RUTINAS) ----------
const RUTINAS = {
  "Rutina Full Body (sin pesas)": {
    descripcion: "Entrenamiento completo sin equipamiento, ideal para ganar tono y fuerza funcional.",
    meta: ["Duraci√≥n: 25-30 min", "Frecuencia: 3x/sem", "Nivel: Todos"],
    pasos: [
      { titulo: "Calentamiento (5 min)", detalle: "Movilidad articular: c√≠rculos de hombros, caderas y tobillos; 1-2 minutos de marcha en el sitio y elevaciones de rodilla suaves. Subir la temperatura corporal para prevenir lesiones." },
      { titulo: "Circuito principal (3 rondas)", detalle: "15 sentadillas profundas (pies a la anchura de caderas), 10 flexiones con t√©cnica controlada (si es necesario apoyadas en rodillas), 20 abdominales tipo crunch. Mant√©n ritmo constante y respira correctamente." },
      { titulo: "Ejercicio de core (plancha)", detalle: "Plancha frontal de 30-45 s. Aseg√∫rate de mantener l√≠nea recta desde cabeza a talones, no hundir la cadera." },
      { titulo: "Descanso activo", detalle: "30-45 s entre rondas. Camina en el sitio y mant√©n respiraci√≥n controlada." },
      { titulo: "Estiramientos (2-4 min)", detalle: "Estira cu√°driceps, isquiotibiales y regi√≥n lumbar. Mant√©n 20-30 s por estiramiento, respira profundo." }
    ]
  },

  "Cardio 20 min en casa": {
    descripcion: "Circuito intervalado para mejorar cardio y quemar calor√≠as en poco tiempo.",
    meta: ["Duraci√≥n: 20 min", "Intensidad: Moderada/Alta", "Frecuencia: 3-5x/sem"],
    pasos: [
      { titulo: "Calentamiento 5 min", detalle: "Marcha en sitio, saltos suaves de tijera, movimientos de brazos y tobillos. Aumenta progresivamente la intensidad."},
      { titulo: "Intervalos (4 rondas)", detalle: "40s trabajo / 20s descanso. Ejercicios: jumping jacks (20-30 rep), mountain climbers (r√°pidos), burpees suavecitos (o sin salto si hace falta), sentadillas con salto moderado."},
      { titulo: "Recuperaci√≥n activa", detalle: "1 min caminando en el sitio, bajar ritmo. Mant√©n respiraci√≥n controlada."},
      { titulo: "Enfriamiento y estiramiento", detalle: "Respira profundo, estira cu√°driceps, gemelos y lumbares durante 3-4 minutos."}
    ]
  },

  "Yoga y estiramientos matutinos": {
    descripcion: "Secuencia suave para activar el cuerpo y la mente al empezar el d√≠a.",
    meta: ["Duraci√≥n: 15-20 min", "Frecuencia: diaria", "Nivel: Suave"],
    pasos: [
      { titulo: "Respiraci√≥n inicial", detalle: "3-5 respiraciones profundas (inhalar por la nariz, exhalar por la boca) para centrarte."},
      { titulo: "Secuencia b√°sica", detalle: "Perro boca abajo ‚Üí plancha ‚Üí cobra: 30s cada postura, repite 2 veces para abrir el pecho y espalda."},
      { titulo: "Guerrero y estiramientos laterales", detalle: "Guerrero I/II 30s por lado para activar piernas y equilibrio."},
      { titulo: "Relajaci√≥n final (Savasana)", detalle: "Acostado 2-3 min, respiraci√≥n lenta y atenci√≥n corporal."}
    ]
  },

  "Ejercicios de estiramiento en oficina": {
    descripcion: "Movimientos pr√°cticos para aliviar tensi√≥n durante la jornada laboral.",
    meta: ["Duraci√≥n: 5-8 min", "Frecuencia: cada 2-3 h"],
    pasos: [
      { titulo: "Giros cervicales controlados", detalle: "Gira el cuello lentamente de lado a lado (10 rep). No forzar; detener si hay dolor."},
      { titulo: "Estiramiento de hombros", detalle: "Cruza un brazo al frente y empuja con el otro para estirar hombro/trapecio (20-30 s cada lado)."},
      { titulo: "Torsi√≥n sentado", detalle: "Sentado, gira el tronco sujetando el respaldo; mant√©n 15-20 s por lado para movilizar la columna."},
      { titulo: "Movilidad de mu√±ecas", detalle: "Extiende brazo y con la otra mano empuja dedos suavemente hacia atr√°s; 15-20 s por mano para evitar molestias por teclado."}
    ]
  },

  "Pausas activas de 10 minutos": {
    descripcion: "Pausa breve y efectiva para reactivar el cuerpo y la mente durante el trabajo.",
    meta: ["Duraci√≥n: 10 min", "Frecuencia: 1-2 veces al d√≠a"],
    pasos: [
      { titulo: "Caminar 1 minuto", detalle: "Caminata moderada alrededor del √°rea de trabajo; balancea los brazos para activar circulaci√≥n."},
      { titulo: "C√≠rculos de brazos y piernas (30s)", detalle: "Haz c√≠rculos amplios con hombros y tobillos para liberar tensi√≥n."},
      { titulo: "Serie r√°pida de fuerza (3x15)", detalle: "3 series de 15 sentadillas lentas y elevaciones de talones (para activar piernas y gemelos). Mant√©n buena t√©cnica."},
      { titulo: "Estiramiento de cuello y mu√±ecas", detalle: "Inclina lateralmente el cuello y estira mu√±ecas; 15-20 s por postura."},
      { titulo: "Respiraci√≥n final 30s", detalle: "Cierra ojos y respira profunda y lenta para volver con concentraci√≥n."}
    ]
  },

  "Movilidad cervical y lumbar": {
    descripcion: "Rutina para mantener movilidad y reducir dolores por malas posturas.",
    meta: ["Duraci√≥n: 12-15 min", "Frecuencia: diaria"],
    pasos: [
      { titulo: "Rotaciones de cuello", detalle: "Movimiento lento en semic√≠rculos; 8-10 rep para cada lado."},
      { titulo: "Gato - Vaca (columna)", detalle: "En cuatro puntos, arquea y redondea columna 10 rep; coordina con respiraci√≥n."},
      { titulo: "Inclinaciones laterales y estiramiento lumbar", detalle: "Inclinaciones laterales sentado; elevaci√≥n p√©lvica suave para movilidad lumbar."},
      { titulo: "Respiraci√≥n y relajaci√≥n", detalle: "Respiraciones profundas acompa√±adas de estiramientos ligeros para completar la sesi√≥n."}
    ]
  },

  "Caminata + trote ligero": {
    descripcion: "Entrenamiento exterior ideal para mejorar resistencia sin impactos fuertes.",
    meta: ["Duraci√≥n: 30-40 min", "Frecuencia: 3-5x/sem"],
    pasos: [
      { titulo: "Calentamiento 5 min", detalle: "Caminata tranquila, movimiento de hombros y tobillos."},
      { titulo: "Alternar camina/trote", detalle: "5 min camina / 3 min trota ligera, repetir hasta completar 30 min. Mant√©n ritmo que permita conversaci√≥n corta."},
      { titulo: "T√©cnica de respiraci√≥n", detalle: "Respira por nariz y boca de forma r√≠tmica para mejor oxigenaci√≥n."},
      { titulo: "Enfriamiento y estiramiento final", detalle: "Caminar suave 3-5 min y estirar cu√°driceps y gemelos."}
    ]
  },

  "Circuito de ejercicios en parque": {
    descripcion: "Secuencia usando bancos y barras para un entrenamiento completo.",
    meta: ["Duraci√≥n: 25-35 min", "Frecuencia: 2-3x/sem"],
    pasos: [
      { titulo: "Dominadas o agarre asistido", detalle: "Si no puedes hacer dominadas completas, usa banda o salto controlado. 6-10 rep x 3 series."},
      { titulo: "Fondos en banco", detalle: "12 rep x 3 series, manos en banco y bajar con control para trabajar tr√≠ceps y pecho."},
      { titulo: "Saltos al banco y pliometr√≠a", detalle: "10 rep x 3 series, controlar la ca√≠da y absorci√≥n para proteger rodillas."},
      { titulo: "Core en c√©sped", detalle: "Plancha 45s, 3 repeticiones, y trabajo abdominal corto para estabilidad."}
    ]
  },

  "Entrenamiento con peso corporal": {
    descripcion: "Sesi√≥n funcional para fuerza y control, solo con tu propio peso.",
    meta: ["Duraci√≥n: 25 min", "Frecuencia: 3-4x/sem"],
    pasos: [
      { titulo: "Calentamiento articular", detalle: "Movimientos de tobillo, rodilla, cadera y hombro (5 min)."},
      { titulo: "Circuito principal 4 rondas", detalle: "12 flexiones, 15 sentadillas, 10 zancadas por pierna. T√©cnica lenta y controlada."},
      { titulo: "Trabajo de core y estabilidad", detalle: "Plancha 45s, Side plank 30s por lado para mejorar control del tronco."},
      { titulo: "Movilidad final y estiramiento", detalle: "Estiramientos est√°ticos 3-5 min para recuperaci√≥n."}
    ]
  }
};

// ---------- FUNCIONES UI ----------
function toggleSection(id) {
  const section = document.getElementById(id);
  document.querySelectorAll('.rutina-section').forEach(sec => {
    if (sec !== section) sec.classList.remove('show');
  });
  section.classList.toggle('show');
}

function mostrarRutinaDetallada(nombre, elemento) {
  // elemento puede venir como 'this' desde el onclick
  // si no se pasa, buscamos el primer elemento con el texto
  if (!elemento) {
    elemento = [...document.querySelectorAll('.rutina-item')].find(li => li.textContent.trim() === nombre);
  }

  const detalle = document.getElementById('detalle-rutina');
  const titulo = document.getElementById('titulo-rutina');
  const descripcion = document.getElementById('descripcion-rutina');
  const meta = document.getElementById('meta-rutina');
  const acordeon = document.getElementById('acordeon-pasos');
  const btnVolver = document.getElementById('btn-volver');

  // marcar activo
  document.querySelectorAll('.rutina-item').forEach(i => i.classList.remove('activa'));
  if (elemento) elemento.classList.add('activa');

  // atenuar otras tarjetas
  document.querySelectorAll('.categoria-card').forEach(card => card.classList.add('inactiva'));
  if (elemento) {
    const miCard = elemento.closest('.categoria-card');
    if (miCard) miCard.classList.remove('inactiva');
  }

  // mostrar detalle
  const rutina = RUTINAS[nombre];
  if (!rutina) return;

  titulo.textContent = nombre;
  descripcion.innerHTML = `<p class="lead">${rutina.descripcion}</p>`;
  meta.innerHTML = rutina.meta.map(m => `<span class="badge bg-secondary me-2">${m}</span>`).join('');

  // construir acorde√≥n con pasos (Bootstrap 5 accordions)
  acordeon.innerHTML = ''; // limpiar
  rutina.pasos.forEach((p, idx) => {
    const idHead = `heading-${idx}-${sanitize(nombre)}`;
    const idBody = `collapse-${idx}-${sanitize(nombre)}`;
    acordeon.innerHTML += `
      <div class="accordion-item">
        <h2 class="accordion-header" id="${idHead}">
          <button class="accordion-button ${idx === 0 ? '' : 'collapsed'}" type="button" data-bs-toggle="collapse" data-bs-target="#${idBody}" aria-expanded="${idx === 0 ? 'true' : 'false'}" aria-controls="${idBody}">
            ${idx + 1}. ${escapeHtml(p.titulo)}
          </button>
        </h2>
        <div id="${idBody}" class="accordion-collapse collapse ${idx === 0 ? 'show' : ''}" aria-labelledby="${idHead}" data-bs-parent="#acordeon-pasos">
          <div class="accordion-body">${escapeHtml(p.detalle)}</div>
        </div>
      </div>`;
  });

  detalle.classList.remove('d-none');
  btnVolver.classList.remove('d-none');
  detalle.scrollIntoView({ behavior: 'smooth' });
}

function restaurarVista() {
  // reactivar todo y ocultar detalle
  document.querySelectorAll('.categoria-card').forEach(card => card.classList.remove('inactiva'));
  document.querySelectorAll('.rutina-item').forEach(i => i.classList.remove('activa'));
  document.getElementById('detalle-rutina').classList.add('d-none');
  document.getElementById('btn-volver').classList.add('d-none');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// utilidades
function sanitize(text) {
  return text.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9\-]/g, '').toLowerCase();
}
function escapeHtml(unsafe) {
  return unsafe
    .replaceAll('&', '&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'", '&#039;');
}
</script>
{% endblock %}
